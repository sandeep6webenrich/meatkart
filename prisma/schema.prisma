generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  phone     String   @unique @db.VarChar(15)
  email     String?  @db.VarChar(255)
  name      String   @db.VarChar(100)
  role      String   @default("customer") @db.VarChar(20) // customer, admin
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  orders    Order[]
  addresses Address[]
  cartItems CartItem[]
  wishlist  Wishlist?
  wallet    Wallet?
  notificationPreference NotificationPreference?
  platters  Platter[]

  @@index([phone])
  @@index([role])
  @@map("users")
}

model Category {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String   @db.VarChar(100)
  slug         String   @unique @db.VarChar(100)
  description  String?
  imageUrl     String?  @map("image_url") @db.VarChar(500)
  displayOrder Int      @default(0) @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  products Product[]

  @@index([slug])
  @@map("categories")
}

model Product {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  categoryId     String    @map("category_id") @db.Uuid
  name           String    @db.VarChar(200)
  slug           String    @unique @db.VarChar(200)
  description    String?
  freshnessNotes String?   @map("freshness_notes") @db.VarChar(500)
  cutTypes       String?   @map("cut_types") // Comma separated values or JSON
  isActive       Boolean   @default(true) @map("is_active")
  stockQuantity  Int       @default(0) @map("stock_quantity")
  freshnessDate  DateTime? @map("freshness_date") @db.Date
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  category       Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  productImages  ProductImage[]
  productWeights ProductWeight[]
  cartItems      CartItem[]
  orderItems     OrderItem[]
  wishlistItems  WishlistItem[]
  platterItems   PlatterItem[]
  locations      Location[]

  @@index([categoryId])
  @@index([slug])
  @@index([isActive])
  @@map("products")
}

model ProductImage {
  id           String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId    String  @map("product_id") @db.Uuid
  imageUrl     String  @map("image_url")
  displayOrder Int     @default(0) @map("display_order")
  isPrimary    Boolean @default(false) @map("is_primary")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model ProductWeight {
  id            String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId     String  @map("product_id") @db.Uuid
  weight        String  @db.VarChar(50)
  price         Decimal @db.Decimal(10, 2)
  discountPrice Decimal? @map("discount_price") @db.Decimal(10, 2)
  isActive      Boolean @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz

  product   Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  cartItems CartItem[]
  orderItems OrderItem[]
  platterItems PlatterItem[]

  @@index([productId])
  @@map("product_weights")
}

model CartItem {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  productId String   @map("product_id") @db.Uuid
  weightId  String   @map("weight_id") @db.Uuid
  cutType   String?  @map("cut_type")
  quantity  Int
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  productWeight ProductWeight @relation(fields: [weightId], references: [id], onDelete: Cascade)

  @@map("cart_items")
}

model Order {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String   @map("user_id") @db.Uuid
  orderNumber    String   @unique @map("order_number") @db.VarChar(50)
  totalAmount    Decimal  @map("total_amount") @db.Decimal(10, 2)
  status         String   @default("pending") @db.VarChar(50)
  deliverySlot   String?  @map("delivery_slot") @db.VarChar(100)
  paymentMethod  String   @map("payment_method") @db.VarChar(50)
  paymentStatus  String   @default("pending") @map("payment_status") @db.VarChar(50)
  deliveryAddress Json?   @map("delivery_address")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]
  payment    Payment?
  delivery   Delivery?

  @@index([userId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@map("orders")
}

model OrderItem {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId    String  @map("order_id") @db.Uuid
  productId  String  @map("product_id") @db.Uuid
  weightId   String  @map("weight_id") @db.Uuid
  cutType    String? @map("cut_type")
  quantity   Int
  unitPrice  Decimal @map("unit_price") @db.Decimal(10, 2)
  totalPrice Decimal @map("total_price") @db.Decimal(10, 2)

  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  productWeight ProductWeight @relation(fields: [weightId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Address {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String  @map("user_id") @db.Uuid
  type      String?
  street    String?
  city      String?
  state     String?
  pincode   String?
  landmark  String?
  isDefault Boolean @default(false) @map("is_default")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model Payment {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId          String   @unique @map("order_id") @db.Uuid
  paymentMethod    String   @map("payment_method")
  paymentProvider  String?  @map("payment_provider")
  transactionId    String?  @map("transaction_id")
  amount           Decimal  @db.Decimal(10, 2)
  status           String
  providerResponse Json?    @map("provider_response")
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Delivery {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId        String    @unique @map("order_id") @db.Uuid
  deliveryPerson String?   @map("delivery_person")
  status         String
  assignedAt     DateTime? @map("assigned_at") @db.Timestamptz
  deliveredAt    DateTime? @map("delivered_at") @db.Timestamptz
  notes          String?

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("deliveries")
}

model Wishlist {
  id        String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String         @unique @map("user_id") @db.Uuid
  createdAt DateTime       @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     WishlistItem[]

  @@map("wishlists")
}

model WishlistItem {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wishlistId String   @map("wishlist_id") @db.Uuid
  productId  String   @map("product_id") @db.Uuid
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz

  wishlist   Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([wishlistId, productId])
  @@map("wishlist_items")
}

model Wallet {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @unique @map("user_id") @db.Uuid
  balance   Decimal  @default(0.00) @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions WalletTransaction[]

  @@map("wallets")
}

model WalletTransaction {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  walletId    String   @map("wallet_id") @db.Uuid
  amount      Decimal  @db.Decimal(10, 2)
  type        String   @db.VarChar(20) // credit, debit
  description String?
  referenceId String?  @map("reference_id") // order_id, refund_id, etc.
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  wallet      Wallet   @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@map("wallet_transactions")
}

model NotificationPreference {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @unique @map("user_id") @db.Uuid
  email     Boolean  @default(true)
  sms       Boolean  @default(true)
  whatsapp  Boolean  @default(true)
  promo     Boolean  @default(true)
  order     Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@map("notification_preferences")
}
 
model Platter {
  id        String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String        @map("user_id") @db.Uuid
  name      String        @db.VarChar(100)
  createdAt DateTime      @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
 
  user  User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  items PlatterItem[]
 
  @@index([userId])
  @@map("platters")
}
 
model PlatterItem {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  platterId String   @map("platter_id") @db.Uuid
  productId String   @map("product_id") @db.Uuid
  weightId  String   @map("weight_id") @db.Uuid
  cutType   String?  @map("cut_type")
  quantity  Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
 

  platter       Platter       @relation(fields: [platterId], references: [id], onDelete: Cascade)
  product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  productWeight ProductWeight @relation(fields: [weightId], references: [id], onDelete: Cascade)

  @@index([platterId])
  @@map("platter_items")
}

model Location {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @db.VarChar(100)
  address   String?
  city      String   @db.VarChar(100)
  state     String   @db.VarChar(100)
  pincode   String   @db.VarChar(20)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  products Product[]

  @@map("locations")
}

model SystemSetting {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key         String   @unique @db.VarChar(100)
  value       String   @db.Text
  description String?
  group       String   @default("general") @db.VarChar(50) // general, payment, integration, etc.
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("system_settings")
}

